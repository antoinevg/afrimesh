<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<!--
 * Afrimesh: easy management for B.A.T.M.A.N. wireless mesh networks
 * Copyright (C) 2008-2009 Meraka Institute of the CSIR
 * All rights reserved.
 *  
 * This software is licensed as free software under the terms of the
 * New BSD License. See /LICENSE for more information.
-->
<html>
  <head>
    <!-- link rel="stylesheet" type="text/css" href="style/reset.css" --> 
    <link rel="stylesheet" type="text/css" href="style/default.css" /> 
    <link rel="stylesheet" type="text/css" href="style/map.default.css"> 
    <link rel="stylesheet" type="text/css" href="style/map.css" /> 
    <link rel="stylesheet" type="text/css" href="style/modules.css"> 
    <!-- link rel="stylesheet" type="text/css" href="style/overlay-router.css" --> 

    <!-- includes ---------------------------------------------------------- -->
    <!-- script type="text/javascript" src="http://getfirebug.com/releases/lite/1.2/firebug-lite-compressed.js"></script -->
    <script type="text/javascript" src="javascript/json.org/json2.min.js"></script>  <!-- TODO update!!! -->
    <script type="text/javascript" src="javascript/jquery/jquery.tools.min.js"></script> <!-- TODO deprecate, only using tooltips -->
    <!-- script type="text/javascript" src="javascript/jquery/jquery.min.js"></script -->
    <script type="text/javascript" src="javascript/jquery/jquery.corner.js"></script> <!-- http://jrc.meerbox.nl/ - TODO deprecate -->
                                                                                      <!-- also look at: http://www.malsup.com/jquery/corner/ -->
                                                                                      <!--               http://www.ruzee.com/files/shadedborder/ -->
    <!-- afrimesh -->
    <script type="text/javascript" src="javascript/afrimesh.utilities.js"></script>
    <script type="text/javascript" src="javascript/afrimesh.platform.js"></script>
    <script type="text/javascript" src="javascript/afrimesh.villagebus.js"></script>
    <script type="text/javascript" src="javascript/afrimesh.storage.js"></script>
    <script type="text/javascript" src="javascript/afrimesh.network.js"></script>
    <script type="text/javascript" src="javascript/afrimesh.customers.js"></script>
    <script type="text/javascript" src="javascript/afrimesh.settings.js"></script>
    <script type="text/javascript" src="javascript/afrimesh.js"></script>

    <!-- One-time initialization/bootstrap ------------------------------- -->
    <script type="text/javascript">  //<![CDATA[    
      $(document).ready(function() {

        /** round menu item corners */
        /*$("#menu .left").corner("bl 13px");*/

        /** init overlay window TODO - should be in network.maps See: http://flowplayer.org/forum/20/21252 */
        /*var api = $("#overlay-router").overlay({ 
            api:true,
            zIndex:200000
            //top: "0%", // TODO - update to latest jquery.tools
          }); 
        evil_display_overlay = function(url) {
           api.getContent().find("iframe.wrap").attr('src', url);
           api.load();
        }*/

        /** global error handler for Ajax requests */
        /*$(document).ajaxError(function(ajax, response, request) {
            console.error("AJAX: " + ajax.type);
            console.error("RESPONSE: " + response.status + " " + response.statusText + "\n" + response.responseText);
            console.error("REQUEST:  " + request.data);
          });*/

        /** populate DOM references to afrimesh.settings */
        /*var elements = $("[id*=afrimesh|settings]");
        elements.each(function(element) {
            $(elements[element]).html(Q(afrimesh, elements[element].id) + "");
          });*/

        /** attach actions to menu */
        // UDE it looks like we're ending up with multiple instances of modules
        //     need to change the code so it either unloads or only ever loads
        //     a module once
        // UDE as the code currently stands we cannot load a module into the
        //     browser as a standalone
        var unloader = function() {  };
        function add_dock_item(item, module) {
          $("ul#dock li#" + item).click(function(event) {
              console.log("Loading menu: " + item);
              $("ul#dock .callout").remove();
              $("ul#dock .callout-border").remove();
              $("ul#dock .underline").removeClass();
              $(this).addClass("underline");
              $(this).append('<span class="callout-border"></span>');
              $(this).append('<span class="callout"></span>');
              unloader(); 
              $("#overlay").css("visibility", "visible");
              $("div#content").hide();
              $("div#content").load("modules/" + module + ".html", function(page) { 
                  $("div#content").fadeIn("slow"); 
                  unloader = ready(); // UDE fades mess with load completion and require a ready() method :(
                });
              return false;
            });
        };
        add_dock_item("people",   "customers.manage");
        add_dock_item("mesh",     "network.devices");
        add_dock_item("gateway",  "network.health");
        add_dock_item("settings", "utility.settings");

        /** set default page */
        $("div#map").load("modules/network.map.html", function(page) { 
            $("div#map").fadeIn("slow"); 
            unloader = ready(); // UDE fades mess with load completion and require a ready() method :(
          });

        /** loading complete, we can now remove our message */
        $("#message-loading").html("");

        /* TODO - debug */
        $("ul#dock li#mesh").click();

        console.debug("$(document).ready() -------------------- end");
      });

     //]]></script>
  </head>
  <body>

    <!-- TODO - should be in network.maps See: http://flowplayer.org/forum/20/21252 -->
    <!-- div class="overlay-router" id="overlay-router">
         <iframe class="wrap" style="overflow-x: hidden;" width="800" height="600" scrolling="no"></iframe>
    </div -->
    
    <!-- the network map ------------------------------------------------- -->
    <div style="border:0px solid green;" id="map">
    </div>
    
    <!-- dock ------------------------------------------------------------ -->
    <ul id="dock" class="round shadow dockleft dockmax">
      <li onclick='
                   if ($("#dock").hasClass("dockleft")) {
                     $("#dock").addClass("dockright").removeClass("dockleft");
                   } else {
                     $("#dock").addClass("dockleft").removeClass("dockright");
                   }'>
        swap
      </li>
      <li onclick='if ($("#dock").hasClass("dockmin")) {
                     $("#dock").addClass("dockmax").removeClass("dockmin");
                     $("#overlay").css("left", "120px");
                   } else {
                     $("#dock").addClass("dockmin").removeClass("dockmax");
                     $("#overlay").css("left", "45px");
                   }'>
        minimize
      </li>
      <hr/>
      <li id="login">Login</li>
      <hr/>
      <li id="people">People</li>
      <li id="mesh">Mesh</li>
      <li id="gateway">Gateways</li>
      <li id="accounts">$$$</li>
      <li id="equipment">Equipment</li>
      <li id="logs">Logs</li>
      <hr/>
      <div style="position:absolute; bottom: 20px; width:100%;">
        <li id="help">Help</li>
        <hr/>
        <li id="settings">Settings</li>
      </div>
    </ul>
    
    <!-- content overlay ------------------------------------------------- -->
    <!-- see http://www.schillmania.com/content/entries/2009/css3-and-the-future/ -->
    <div id="overlay" class="round shadow">
      <div style="position:absolute; right:20px;"
           onClick='$("#overlay").css("visibility", "hidden");
                    $("ul#dock .callout").remove();
                    $("ul#dock .callout-border").remove();
                    $("ul#dock .underline").removeClass();'>
        hide
      </div>
      <div id="content">
        please wait a moment...
      </div>
    </div>
    
    <!-- live chat ------------------------------------------------------- -->
    <div id="live-chat" style="padding-left: 1.0em;" ></div> 
    
  </body>
</html>
