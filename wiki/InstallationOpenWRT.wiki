#summary TODO - replace with afrimesh-config package
#labels Phase-Deploy

= Configuration Parameters =
|| *parameter* || *description* || *example* || *actual* . . . . . . . . . . . . . . . . . . . . ||
|| ifname || Your wireless interface || wl0 on broadcom & ath0 on atheros ||  ||
|| channel || The channel your mesh is running on || e.g. 5 ||  ||
|| ssid || The SSID your mesh is using || e.g. batman ||  ||
|| bssid || The BSSID your mesh is using || e.g. "BB:BB:BB:BB:BB:BB" ||  ||
|| ipaddr || The ip address your router will have on the mesh || e.g. 10.0.0.6 || ||
|| netmask || The netmask your mesh uses || e.g. 255.0.0.0 || ||
|| visualisation_srv || The ip address of the B.A.T.M.A.N. vis server || e.g. 192.168.20.225 || ||


= Flashing The Router =

  * FlashMerakiMini
  * FlashLinksysWRT54GL


= Basic Router Configuration =
  # Plug computer into router ethernet
  # Set computer IP to 192.168.1.9
  # Telnet into router
  {{{
  telnet 192.168.1.1
  }}}
  # Run:
  {{{
  uci delete network.lan.type
  uci set network.wifi=interface
  uci set network.wifi.ifname=<ifname>
  uci set network.wifi.proto=static
  uci set network.wifi.ipaddr=<ipaddr>
  uci set network.wifi.netmask=<netmask>
  uci set wireless.wifi0.disabled=0
  uci set wireless.wifi0.channel=<channel>
  uci set wireless.@wifi-iface[0].ssid=<ssid>
  uci set wireless.@wifi-iface[0].mode=adhoc 
  uci set wireless.@wifi-iface[0].bssid=<bssid>
  uci set wireless.@wifi-iface[0].network=wifi           
  uci commit
  }}}  


= B.A.T.M.A.N. =
batmand is the mesh routing daemon and is responsible for ensuring that all packets on the mesh end up where they belong.

  # Configure router to connect to the server address listed in the router's /etc/opkg.conf 
  {{{
  route add default gw <internet-gateway-on-the-routers-subnet>
  }}}
  # Configure router to resolve the server address listed in the router's /etc/opkg.conf. 
  Edit /etc/resolv.conf:
  {{{
  nameserver <your-dns-server>
  }}}  
  # Run:
  {{{
  opkg update
  opkg install batmand
  uci set batmand.general.routing_class=3
  uci set batmand.general.visualisation_srv=192.168.20.225
  uci commit
  cd /etc/rc.d
  ln -s ../init.d/batmand S80batmand
  }}}


= Afrimesh Base = 
Afrimesh base provides the minimum of packages required for a router to communicate with the management dashboard.

  * Run:
  {{{
  opkg update
  opkg install afrimesh-base
  }}}


= Afrimesh Portal = 
Afrimesh portal provides the configuration files to run a [http://coova.org CoovaChilli] captive portal on each mesh router.

The captive portal software is used to control access to the mesh&internet as well as enforcing bandwidth allocation.

  * Run:
  {{{
  opkg update
  opkg install afrimesh-portal
  }}}