<!--
 * Afrimesh: easy management for B.A.T.M.A.N. wireless mesh networks
 * Copyright (C) 2008-2009 Meraka Institute of the CSIR
 * All rights reserved.
 *  
 * This software is licensed as free software under the terms of the
 * New BSD License. See /LICENSE for more information.
-->

<script type="text/javascript"> //<![CDATA[    
(function() {

  /** includes ------------------------------------------------------------ */
  load("javascript/jquery/jquery.sparkline.js");

  /** construction -------------------------------------------------------- */
  ready = function() { // INJ 'ready' should be the only symbol we're exposing to the global namespace
    $(".traffic-village").sparkline([5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3], {type: 'bar'});  // TODO - lose
    console.debug("loaded network.health.html");
    update();
    return unload;
  };

  function unload() {
    console.debug("unloading network.health.html");
    clearTimeout(timer);
  };


  /** update displays ----------------------------------------------------- */
  var timer = {};
  function update() {
    clearTimeout(timer);
    var data = afrimesh.villagebus.snmp(afrimesh.settings.hosts.internet_gateway, 
                                        afrimesh.settings.community, 
                                        [ ".1.3.6.1.2.1.2.2.1.10.4",    /* interfaces.ifTable.ifEntry.ifInOctets.4  ->  eth0.1 == .4 */
                                          ".1.3.6.1.2.1.2.2.1.16.4" ]); /* interfaces.ifTable.ifEntry.ifOutOctets.4 ->  eth0.1 == .4 */
    update_internet_traffic(data);
    timer = setTimeout(update, 10000);
  };

  function update_internet_traffic(data) {
    console.debug("update: " + dump_object(data));
  };


  /** done ---------------------------------------------------------------- */
  console.debug("loaded network.health.js");

})();
//]]></script>




<h2>Health</h2>

<table border=1>
  <tr><td>Mesh</td><td><span style="color:green;">feeling good</span></td></tr>
  <tr><td>Internet Connection</td><td><span style="color:green;">feeling good</span></td></tr>
</table>
<br/>

<h2>Traffic</h2>
<table border=1>
  <tr>
    <td>Mesh</td>
    <td><span style="color:gray;">TODO</span></td>
    <td><span class="traffic-village"></span></td>
    <td>?/? nodes congested</td>
  </tr>
  <tr>
    <td>Internet</td>
    <td><span id="traffic-internet-busy"></span></td>
    <td><span id="traffic-internet">searching...</span></td>
    <td><span id="traffic-internet-in">?</span>/<span id="traffic-internet-in-max">?</span>Kbps in, 
      <span style="color:gray;">
        <span id="traffic-internet-out">?</span>/<span id="traffic-internet-out-max">?</span>Kbps out
      </span>
    </td>
  </tr>
</table>
<br/>

<h2>Messages</h2>
<div id="messages"></div>

<table style="color:gray;" border=1>
  <tr>
    <td>
      TODO
    </td>
    <td>
    </td>
  </tr>
</table> 



