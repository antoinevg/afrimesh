<!--
 * Afrimesh: easy management for B.A.T.M.A.N. wireless mesh networks
 * Copyright (C) 2008-2009 Meraka Institute of the CSIR
 * All rights reserved.
 *  
 * This software is licensed as free software under the terms of the
 * New BSD License. See /LICENSE for more information.
-->

<h2>Network Map</h2>

<div id="network-map" style="border:0px red solid; width: 100%; height: 75%;">please wait a moment...</div>


<script type="text/javascript">( //<![CDATA[    
function() {

  /** includes ------------------------------------------------------------ */
  load("modules/network.map.js");

  /** construction -------------------------------------------------------- */
  ready = function() {
    console.debug("loaded network.map.html");
    $("div#network-map").html("");
    var network_map = new Map("network-map",  // TODO - consider caching the map :)
                              afrimesh.settings.location.longitude,
                              afrimesh.settings.location.latitude,
                              afrimesh.settings.map.extent,
                              afrimesh.settings.map.zoom);
    update(network_map);
    return unload;
  };

  function unload() {
    clearTimeout(timer);
    console.debug("unloaded network.map.html");
  };
  console.debug("loaded network.map.js");


  /** update map ---------------------------------------------------------- */
  var timer = {};
  function update(network_map) {
    clearTimeout(timer);
    var now = new Date();

    // tag all active network elements with last seen time and add new elements to the map
    afrimesh.network.mesh.routers().map(function(router) { 
        var router_feature = network_map.router(router);
        router_feature.last_seen = now;
        router.routes.map(function(route) {
            var route_feature = network_map.route(route);
            route_feature.last_seen = now; 
          });
      });

    
    // go through all map features and set transparency relative to when they were last seen
  

    //console.debug("updated network map");
    timer = setTimeout(function() { update(network_map); }, 10000);
  };

})();
//]]></script>







